<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reclamo de Cliente â€” FORTE UNIVERSAL</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0a;
  --surface: #111111;
  --surface2: #1a1a1a;
  --surface3: #222222;
  --border: #2a2a2a;
  --border2: #333333;
  --accent: #e8a000;
  --accent2: #ffbe3a;
  --accent-dim: rgba(232,160,0,0.1);
  --danger: #e84040;
  --success: #00c47a;
  --text: #f0ece4;
  --muted: #666;
  --muted2: #888;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Barlow', sans-serif;
  min-height: 100vh;
  padding: 0 0 4rem;
}

/* â”€â”€ HERO HEADER â”€â”€ */
.hero {
  background: var(--surface);
  border-bottom: 3px solid var(--accent);
  padding: 1.5rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  position: relative;
  overflow: hidden;
}

.hero::before {
  content: 'ğŸ“‹';
  position: absolute;
  font-size: 18rem;
  right: -3rem;
  top: -4rem;
  opacity: 0.03;
  pointer-events: none;
  filter: grayscale(1);
}

.hero-left {
  display: flex;
  align-items: center;
  gap: 1.2rem;
}

.tire-icon {
  width: 48px;
  height: 48px;
  border: 3px solid var(--accent);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;
  flex-shrink: 0;
  position: relative;
}



.hero-title {
  font-family: 'Barlow Condensed', sans-serif;
}

.hero-title h1 {
  font-size: clamp(1.3rem, 3vw, 1.8rem);
  font-weight: 900;
  color: var(--text);
  letter-spacing: 0.03em;
  text-transform: uppercase;
  line-height: 1;
}

.hero-title p {
  font-size: 0.78rem;
  color: var(--muted2);
  font-weight: 400;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  margin-top: 0.2rem;
}

.hero-badge {
  background: var(--accent);
  color: #000;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.7rem;
  font-weight: 800;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  padding: 0.3rem 0.8rem;
  flex-shrink: 0;
}

/* â”€â”€ MAIN WRAPPER â”€â”€ */
.wrapper {
  max-width: 720px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

/* â”€â”€ STEP INDICATOR â”€â”€ */
.steps {
  display: flex;
  gap: 0;
  margin-bottom: 2rem;
  border: 1px solid var(--border);
}

.step {
  flex: 1;
  padding: 0.6rem 0.5rem;
  text-align: center;
  border-right: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.2s;
  position: relative;
}
.step:last-child { border-right: none; }

.step-num {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 1.1rem;
  font-weight: 900;
  color: var(--muted);
  line-height: 1;
}

.step-label {
  font-size: 0.6rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-top: 0.1rem;
}

.step.active .step-num { color: var(--accent); }
.step.active .step-label { color: var(--accent2); }
.step.active { background: var(--accent-dim); }
.step.done .step-num { color: var(--success); }
.step.done::after {
  content: 'âœ“';
  position: absolute;
  top: 4px; right: 6px;
  font-size: 0.6rem;
  color: var(--success);
}

/* â”€â”€ PANELS â”€â”€ */
.panel { display: none; animation: fadeUp 0.35s ease both; }
.panel.active { display: block; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(12px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* â”€â”€ SECTION â”€â”€ */
.section {
  background: var(--surface);
  border: 1px solid var(--border);
  margin-bottom: 1rem;
}

.section-header {
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  padding: 0.7rem 1.2rem;
  display: flex;
  align-items: center;
  gap: 0.8rem;
}

.section-num {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.65rem;
  font-weight: 800;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--accent);
  background: var(--accent-dim);
  border: 1px solid var(--accent);
  padding: 0.15rem 0.5rem;
}

.section-title {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.8rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--muted2);
}

.section-body { padding: 1.2rem; }

/* â”€â”€ FIELDS â”€â”€ */
.field { margin-bottom: 1rem; }
.field:last-child { margin-bottom: 0; }

.field label {
  display: block;
  font-size: 0.68rem;
  font-weight: 600;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--muted2);
  margin-bottom: 0.35rem;
}

.field label .req { color: var(--accent); margin-left: 2px; }

input[type="text"],
input[type="number"],
input[type="date"],
input[type="email"],
select,
textarea {
  width: 100%;
  background: var(--surface2);
  border: 1px solid var(--border2);
  color: var(--text);
  font-family: 'Barlow', sans-serif;
  font-size: 0.9rem;
  padding: 0.65rem 0.9rem;
  outline: none;
  border-radius: 0;
  transition: border-color 0.15s, background 0.15s;
  -webkit-appearance: none;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--accent);
  background: var(--surface3);
}

input::placeholder, textarea::placeholder { color: #444; }
select { cursor: pointer; }
select option { background: #1a1a1a; }

.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
.grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; }

/* â”€â”€ MOTIVO PILLS â”€â”€ */
.motivo-group { display: flex; gap: 0.8rem; }
.motivo-opt input[type="radio"] { display: none; }
.motivo-opt label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.65rem 1.4rem;
  background: var(--surface2);
  border: 1.5px solid var(--border2);
  color: var(--muted2);
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.85rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
  flex: 1;
  justify-content: center;
}
.motivo-opt label .dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: var(--border2);
  flex-shrink: 0;
  transition: background 0.15s;
}
.motivo-opt input[type="radio"]:checked + label {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-dim);
}
.motivo-opt input[type="radio"]:checked + label .dot {
  background: var(--accent);
  box-shadow: 0 0 6px var(--accent);
}

/* â”€â”€ PRODUCTOS â”€â”€ */
.products-list { display: flex; flex-direction: column; gap: 0.8rem; }

.product-card {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-left: 3px solid var(--accent);
  padding: 1rem;
  animation: fadeUp 0.25s ease both;
}

.product-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.8rem;
}

.product-label {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.7rem;
  font-weight: 800;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--accent);
}

.btn-remove {
  background: none;
  border: 1px solid var(--border2);
  color: var(--danger);
  font-size: 0.68rem;
  font-family: 'Barlow Condensed', sans-serif;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  padding: 0.2rem 0.7rem;
  cursor: pointer;
  transition: all 0.15s;
}
.btn-remove:hover { background: var(--danger); color: #fff; border-color: var(--danger); }

.btn-add-product {
  width: 100%;
  padding: 0.7rem;
  background: none;
  border: 1.5px dashed var(--border2);
  color: var(--muted2);
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.75rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  cursor: pointer;
  margin-top: 0.6rem;
  transition: all 0.15s;
}
.btn-add-product:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }

/* â”€â”€ FOTOS â”€â”€ */
.photo-zone {
  border: 2px dashed var(--border2);
  background: var(--surface2);
  padding: 1.5rem 1rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}
.photo-zone:hover, .photo-zone.over {
  border-color: var(--accent);
  background: var(--accent-dim);
}
.photo-zone input[type="file"] {
  position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
}
.photo-zone-icon { font-size: 1.8rem; margin-bottom: 0.4rem; }
.photo-zone p {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.8rem; font-weight: 700;
  letter-spacing: 0.1em; text-transform: uppercase;
  color: var(--muted2);
}
.photo-zone span { font-size: 0.72rem; color: var(--muted); margin-top: 0.2rem; display: block; }

.photo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 0.5rem;
  margin-top: 0.8rem;
}
.photo-thumb {
  position: relative; aspect-ratio: 1;
  border: 1px solid var(--border2); overflow: hidden;
  animation: fadeUp 0.2s ease both;
}
.photo-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
.photo-thumb .rm-photo {
  position: absolute; top: 3px; right: 3px;
  background: rgba(0,0,0,0.75); color: #fff; border: none;
  width: 18px; height: 18px; border-radius: 50%;
  font-size: 0.6rem; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
}
.photo-info {
  margin-top: 0.5rem;
  font-size: 0.72rem; color: var(--muted);
  font-family: 'Barlow Condensed', sans-serif;
  letter-spacing: 0.05em;
}
.photo-info.full { color: var(--accent); }

/* â”€â”€ PROGRESS â”€â”€ */
.upload-prog { display: none; margin-top: 0.8rem; }
.upload-prog.show { display: block; }
.prog-label {
  display: flex; justify-content: space-between;
  font-size: 0.68rem; font-family: 'Barlow Condensed', sans-serif;
  font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase;
  color: var(--muted2); margin-bottom: 0.3rem;
}
.prog-track { height: 4px; background: var(--border2); }
.prog-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }

/* â”€â”€ NAVIGATION BUTTONS â”€â”€ */
.nav-btns {
  display: flex;
  gap: 0.8rem;
  margin-top: 1.5rem;
}

.btn-back {
  padding: 0.85rem 1.5rem;
  background: none;
  border: 1px solid var(--border2);
  color: var(--muted2);
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.8rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
}
.btn-back:hover { border-color: var(--muted2); color: var(--text); }

.btn-next {
  flex: 1;
  padding: 0.85rem;
  background: var(--accent);
  color: #000;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.85rem;
  font-weight: 900;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  border: none;
  cursor: pointer;
  transition: background 0.15s, transform 0.1s;
}
.btn-next:hover { background: var(--accent2); transform: translateY(-1px); }
.btn-next:active { transform: translateY(0); }
.btn-next:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; }

.btn-submit {
  flex: 1;
  padding: 1rem;
  background: var(--accent);
  color: #000;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.9rem;
  font-weight: 900;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  border: none;
  cursor: pointer;
  transition: background 0.15s, transform 0.1s;
  box-shadow: 0 4px 20px rgba(232,160,0,0.3);
}
.btn-submit:hover { background: var(--accent2); transform: translateY(-1px); }
.btn-submit:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none; }

/* â”€â”€ ERRORS â”€â”€ */
.err { color: var(--danger); font-size: 0.7rem; margin-top: 0.3rem; display: none; }
.err.show { display: block; }

/* â”€â”€ SUCCESS â”€â”€ */
.success-screen {
  display: none;
  text-align: center;
  padding: 3rem 1.5rem;
  background: var(--surface);
  border: 1px solid var(--border);
}
.success-screen.show { display: block; animation: fadeUp 0.5s ease both; }

.success-tire {
  font-size: 3.5rem;
  margin-bottom: 1rem;
  animation: spin1 0.6s ease both 0.2s;
}
@keyframes spin1 {
  from { transform: rotate(-180deg) scale(0); opacity: 0; }
  to   { transform: rotate(0deg) scale(1); opacity: 1; }
}

.success-screen h2 {
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 2rem;
  font-weight: 900;
  color: var(--success);
  letter-spacing: 0.05em;
  text-transform: uppercase;
  margin-bottom: 0.5rem;
}

.folio-tag {
  display: inline-block;
  background: var(--accent-dim);
  border: 1.5px solid var(--accent);
  color: var(--accent);
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 1.6rem;
  font-weight: 900;
  letter-spacing: 0.1em;
  padding: 0.5rem 1.8rem;
  margin: 1rem 0;
}

.success-screen p { color: var(--muted2); font-size: 0.9rem; margin-bottom: 0.4rem; }

.btn-nuevo {
  margin-top: 1.5rem;
  padding: 0.8rem 2.5rem;
  background: var(--accent);
  color: #000;
  font-family: 'Barlow Condensed', sans-serif;
  font-size: 0.85rem;
  font-weight: 900;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  border: none;
  cursor: pointer;
}

.spinner {
  display: inline-block; width: 14px; height: 14px;
  border: 2px solid rgba(0,0,0,0.3); border-top-color: #000;
  border-radius: 50%; animation: spin 0.6s linear infinite;
  margin-right: 8px; vertical-align: middle;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ SUMMARY BOX (step 3) â”€â”€ */
.summary-box {
  background: var(--surface2);
  border: 1px solid var(--border2);
  border-left: 3px solid var(--accent);
  padding: 1rem 1.2rem;
  margin-bottom: 0.8rem;
}
.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: 0.3rem 0;
  border-bottom: 1px solid var(--border);
  font-size: 0.85rem;
  gap: 1rem;
}
.summary-row:last-child { border-bottom: none; }
.summary-key {
  color: var(--muted2);
  font-size: 0.68rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  flex-shrink: 0;
  min-width: 130px;
}
.summary-val { color: var(--text); text-align: right; word-break: break-word; }

@media (max-width: 500px) {
  .grid-2, .grid-3 { grid-template-columns: 1fr; }
  .motivo-group { flex-direction: column; }
  .hero { flex-direction: column; align-items: flex-start; }
  .steps { overflow-x: auto; }
}
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <div class="hero-left">
    <div class="tire-icon">ğŸ“¦</div>
    <div class="hero-title">
      <h1>Reclamo de Cliente</h1>
      <p>Registro de Incidencias</p>
    </div>
  </div>
  <div class="hero-badge">VTS System</div>
</div>

<div class="wrapper">

  <!-- STEPS -->
  <div class="steps">
    <div class="step active" id="step-tab-1">
      <div class="step-num">01</div>
      <div class="step-label">Generales</div>
    </div>
    <div class="step" id="step-tab-2">
      <div class="step-num">02</div>
      <div class="step-label">Productos</div>
    </div>
    <div class="step" id="step-tab-3">
      <div class="step-num">03</div>
      <div class="step-label">Evidencia</div>
    </div>
    <div class="step" id="step-tab-4">
      <div class="step-num">04</div>
      <div class="step-label">Confirmar</div>
    </div>
  </div>

  <form id="mainForm" novalidate>

    <!-- â”€â”€ PANEL 1: DATOS GENERALES â”€â”€ -->
    <div class="panel active" id="panel-1">

      <div class="section">
        <div class="section-header">
          <span class="section-num">A</span>
          <span class="section-title">ClasificaciÃ³n</span>
        </div>
        <div class="section-body">
          <div class="grid-2">
            <div class="field">
              <label>Unidad de negocio <span class="req">*</span></label>
              <input type="text" id="unidad" list="lista-unidad" placeholder="IT / RAC / RPROS / FORTE" autocomplete="off">
              <datalist id="lista-unidad">
                <option value="IT">
                <option value="RAC">
                <option value="RPROS">
                <option value="FORTE">
              </datalist>
              <div class="err" id="err-unidad">Campo requerido.</div>
            </div>
            <div class="field">
              <label>AlmacÃ©n <span class="req">*</span></label>
              <input type="text" id="almacen" list="lista-almacen" placeholder="Oleoducto / Manzanillo / Ecommerce-Oleoducto" autocomplete="off">
              <datalist id="lista-almacen">
                <option value="Oleoducto">
                <option value="Manzanillo">
                <option value="Ecommerce-Oleoducto">
              </datalist>
              <div class="err" id="err-almacen">Campo requerido.</div>
            </div>
          </div>
          <div class="grid-2">
            <div class="field">
              <label>OV (Orden de Venta) <span class="req">*</span></label>
              <input type="text" id="ov" placeholder="Ej. OV-2026-00891">
              <div class="err" id="err-ov">Campo requerido.</div>
            </div>
            <div class="field">
              <label>Cliente <span class="req">*</span></label>
              <input type="text" id="cliente" placeholder="Nombre del cliente">
              <div class="err" id="err-cliente">Campo requerido.</div>
            </div>
          </div>

        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <span class="section-num">B</span>
          <span class="section-title">Fechas</span>
        </div>
        <div class="section-body">
          <div class="grid-3">
            <div class="field">
              <label>Fecha de carga <span class="req">*</span></label>
              <input type="date" id="fechaCarga">
              <div class="err" id="err-fechaCarga">Campo requerido.</div>
            </div>
            <div class="field">
              <label>Fecha de entrega <span class="req">*</span></label>
              <input type="date" id="fechaEntrega">
              <div class="err" id="err-fechaEntrega">Campo requerido.</div>
            </div>
            <div class="field">
              <label>Fecha reporte VTS <span class="req">*</span></label>
              <input type="date" id="fechaReporte">
              <div class="err" id="err-fechaReporte">Campo requerido.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-header">
          <span class="section-num">C</span>
          <span class="section-title">Registrado por</span>
        </div>
        <div class="section-body">
          <div class="field">
            <label>Nombre de quien registra <span class="req">*</span></label>
            <input type="text" id="registradoPor" placeholder="Nombre completo">
            <div class="err" id="err-registradoPor">Campo requerido.</div>
          </div>
        </div>
      </div>

      <div class="nav-btns">
        <button type="button" class="btn-next" onclick="goTo(2)">Siguiente â€” Productos â†’</button>
      </div>
    </div>

    <!-- â”€â”€ PANEL 2: PRODUCTOS â”€â”€ -->
    <div class="panel" id="panel-2">
      <div class="section">
        <div class="section-header">
          <span class="section-num">D</span>
          <span class="section-title">Productos del reclamo</span>
        </div>
        <div class="section-body">
          <div class="products-list" id="productsList"></div>
          <button type="button" class="btn-add-product" id="btnAdd">+ Agregar otro producto</button>
          <div class="err" id="err-products" style="margin-top:0.5rem">Completa todos los campos de los productos.</div>
        </div>
      </div>
      <div class="nav-btns">
        <button type="button" class="btn-back" onclick="goTo(1)">â† AtrÃ¡s</button>
        <button type="button" class="btn-next" onclick="goTo(3)">Siguiente â€” Evidencia â†’</button>
      </div>
    </div>

    <!-- â”€â”€ PANEL 3: FOTOS â”€â”€ -->
    <div class="panel" id="panel-3">
      <div class="section">
        <div class="section-header">
          <span class="section-num">E</span>
          <span class="section-title">Evidencia fotogrÃ¡fica <span style="color:var(--muted);font-weight:400;font-size:0.65rem;">(opcional â€” mÃ¡x. 10 fotos)</span></span>
        </div>
        <div class="section-body">
          <div class="photo-zone" id="photoZone">
            <input type="file" id="photoInput" accept="image/*" multiple>
            <div class="photo-zone-icon">ğŸ“·</div>
            <p>Toca aquÃ­ para agregar fotos</p>
            <span>JPG, PNG, HEIC â€” mÃ¡ximo 10 imÃ¡genes</span>
          </div>
          <div class="photo-grid" id="photoGrid"></div>
          <div class="photo-info" id="photoInfo"></div>
          <div class="upload-prog" id="uploadProg">
            <div class="prog-label">
              <span>Subiendo a OneDrive...</span>
              <span id="progText">0/0</span>
            </div>
            <div class="prog-track"><div class="prog-fill" id="progFill"></div></div>
          </div>
        </div>
      </div>
      <div class="nav-btns">
        <button type="button" class="btn-back" onclick="goTo(2)">â† AtrÃ¡s</button>
        <button type="button" class="btn-next" onclick="goTo(4)">Siguiente â€” Confirmar â†’</button>
      </div>
    </div>

    <!-- â”€â”€ PANEL 4: RESUMEN â”€â”€ -->
    <div class="panel" id="panel-4">
      <div class="section">
        <div class="section-header">
          <span class="section-num">F</span>
          <span class="section-title">Confirmar y enviar</span>
        </div>
        <div class="section-body">
          <div class="summary-box" id="summaryBox"></div>
          <p style="font-size:0.75rem;color:var(--muted);margin-top:0.8rem;">
            âš ï¸ Verifica que todos los datos sean correctos antes de enviar. El folio se generarÃ¡ automÃ¡ticamente al enviar.
          </p>
        </div>
      </div>
      <div class="nav-btns">
        <button type="button" class="btn-back" onclick="goTo(3)">â† AtrÃ¡s</button>
        <button type="button" class="btn-submit" id="submitBtn" onclick="submitForm()">
          âœ” Registrar incidencia
        </button>
      </div>
    </div>

  </form>

  <!-- SUCCESS -->
  <div class="success-screen" id="successScreen">
    <div class="success-tire">âœ…</div>
    <h2>Â¡Incidencia registrada!</h2>
    <p>Tu folio de seguimiento es:</p>
    <div class="folio-tag" id="successFolio">â€”</div>
    <p>Los datos se guardaron en Excel y recibirÃ¡s confirmaciÃ³n por correo.</p>
    <p id="noteTest" style="display:none;color:var(--accent);font-size:0.78rem;margin-top:0.5rem;">âš ï¸ Modo prueba â€” Power Automate no conectado aÃºn.</p>
    <br>
    <button class="btn-nuevo" onclick="resetAll()">+ Nueva incidencia</button>
  </div>

</div>

<script>
// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const POWER_AUTOMATE_URL = "https://defaultfff6ebb60a0548bcb043b15e0fe55d.80.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/10d0b1c0cc074c6e9bbf40cb6f80b931/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=VuWCItxj6ZNbQlBUghuWwMl2NHu_UEkINRdgGOAj3DA";
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

let productCount = 0;
let photos = [];
const MAX_PHOTOS = 10;

// â”€â”€ STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goTo(step) {
  if (step > 1 && !validatePanel(currentPanel())) return;
  if (step === 4) buildSummary();

  document.querySelectorAll('.panel').forEach((p, i) => {
    p.classList.toggle('active', i + 1 === step);
  });
  document.querySelectorAll('.step').forEach((s, i) => {
    s.classList.remove('active', 'done');
    if (i + 1 === step) s.classList.add('active');
    if (i + 1 < step) s.classList.add('done');
  });
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function currentPanel() {
  const panels = document.querySelectorAll('.panel');
  for (let i = 0; i < panels.length; i++) {
    if (panels[i].classList.contains('active')) return i + 1;
  }
  return 1;
}

// â”€â”€ VALIDATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showErr(id, show) {
  const el = document.getElementById('err-' + id);
  if (el) el.classList.toggle('show', show);
}

function validatePanel(panel) {
  if (panel === 1) {
    let ok = true;
    ['unidad','almacen','ov','cliente','fechaCarga','fechaEntrega','fechaReporte','registradoPor'].forEach(id => {
      const empty = !document.getElementById(id)?.value.trim();
      showErr(id, empty); if (empty) ok = false;
    });

    return ok;
  }
  if (panel === 2) {
    return validateProducts();
  }
  return true;
}

// â”€â”€ PRODUCTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addProduct() {
  productCount++;
  const list = document.getElementById('productsList');
  const div = document.createElement('div');
  div.className = 'product-card';
  div.id = 'pc-' + productCount;
  div.innerHTML = `
    <div class="product-card-header">
      <span class="product-label">Producto ${productCount}</span>
      ${productCount > 1 ? `<button type="button" class="btn-remove" onclick="removeProduct(${productCount})">âœ• Quitar</button>` : ''}
    </div>
    <div class="grid-2" style="margin-bottom:0.8rem">
      <div class="field" style="margin-bottom:0">
        <label>Marca <span class="req">*</span></label>
        <input type="text" class="p-marca" placeholder="Ej. Bridgestone">
      </div>
      <div class="field" style="margin-bottom:0">
        <label>SKU <span class="req">*</span></label>
        <input type="text" class="p-sku" placeholder="Ej. P205/55R16">
      </div>
    </div>
    <div class="grid-2">
      <div class="field" style="margin-bottom:0">
        <label>DescripciÃ³n <span class="req">*</span></label>
        <input type="text" class="p-desc" placeholder="Ej. Llanta turismo 16 pulgadas">
      </div>
      <div class="field" style="margin-bottom:0">
        <label>Piezas <span class="req">*</span></label>
        <input type="number" class="p-piezas" placeholder="Ej. 4" min="1">
      </div>
    </div>
    <div class="field" style="margin-top:0.8rem;margin-bottom:0">
      <label>Motivo <span class="req">*</span></label>
      <div class="motivo-group">
        <div class="motivo-opt">
          <input type="radio" name="motivo-${productCount}" id="mF-${productCount}" value="FALTANTE">
          <label for="mF-${productCount}"><span class="dot"></span>Faltante</label>
        </div>
        <div class="motivo-opt">
          <input type="radio" name="motivo-${productCount}" id="mS-${productCount}" value="SOBRANTE">
          <label for="mS-${productCount}"><span class="dot"></span>Sobrante</label>
        </div>
      </div>
    </div>
  `;
  list.appendChild(div);
  renumberProducts();
}

function removeProduct(id) {
  const el = document.getElementById('pc-' + id);
  if (el) el.remove();
  renumberProducts();
}

function renumberProducts() {
  document.querySelectorAll('.product-card').forEach((c, i) => {
    const lbl = c.querySelector('.product-label');
    if (lbl) lbl.textContent = `Producto ${i + 1}`;
  });
}

function getProducts() {
  const cards = document.querySelectorAll('.product-card');
  return Array.from(cards).map(c => ({
    marca:   c.querySelector('.p-marca').value.trim(),
    sku:     c.querySelector('.p-sku').value.trim(),
    desc:    c.querySelector('.p-desc').value.trim(),
    piezas:  c.querySelector('.p-piezas').value.trim(),
    motivo:  c.querySelector('input[type="radio"]:checked')?.value || ''
  }));
}

function validateProducts() {
  const products = getProducts();
  const invalid = products.some(p => !p.marca || !p.sku || !p.desc || !p.piezas || !p.motivo);
  document.getElementById('err-products').classList.toggle('show', invalid || products.length === 0);
  return !invalid && products.length > 0;
}

// â”€â”€ PHOTOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('photoInput').addEventListener('change', function(e) {
  addPhotos(Array.from(e.target.files));
  this.value = '';
});

const zone = document.getElementById('photoZone');
zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('over'); });
zone.addEventListener('dragleave', () => zone.classList.remove('over'));
zone.addEventListener('drop', e => {
  e.preventDefault(); zone.classList.remove('over');
  addPhotos(Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/')));
});

function addPhotos(files) {
  const rem = MAX_PHOTOS - photos.filter(Boolean).length;
  files.slice(0, rem).forEach(file => {
    const idx = photos.length;
    photos.push(file);
    const reader = new FileReader();
    reader.onload = ev => {
      const div = document.createElement('div');
      div.className = 'photo-thumb'; div.id = 'pt-' + idx;
      div.innerHTML = `<img src="${ev.target.result}"><button type="button" class="rm-photo" onclick="removePhoto(${idx})">âœ•</button>`;
      document.getElementById('photoGrid').appendChild(div);
    };
    reader.readAsDataURL(file);
  });
  updatePhotoInfo();
}

function removePhoto(idx) {
  photos[idx] = null;
  const el = document.getElementById('pt-' + idx);
  if (el) el.remove();
  updatePhotoInfo();
}

function updatePhotoInfo() {
  const count = photos.filter(Boolean).length;
  const el = document.getElementById('photoInfo');
  el.textContent = count > 0 ? `${count} foto${count !== 1 ? 's' : ''} seleccionada${count !== 1 ? 's' : ''}` : '';
  el.className = 'photo-info' + (count >= MAX_PHOTOS ? ' full' : '');
}

function activePhotos() { return photos.filter(Boolean); }

function fileToB64(file) {
  return new Promise((res, rej) => {
    const r = new FileReader();
    r.onload = () => res(r.result.split(',')[1]);
    r.onerror = rej;
    r.readAsDataURL(file);
  });
}

// â”€â”€ SUMMARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildSummary() {
  const products = getProducts();
  const motivo = document.querySelector('input[name="motivo"]:checked')?.value || '';
  const rows = [
    ['Unidad',            document.getElementById('unidad').value],
    ['AlmacÃ©n',           document.getElementById('almacen').value],
    ['OV',                document.getElementById('ov').value],
    ['Cliente',           document.getElementById('cliente').value],
    ['Fecha carga',       document.getElementById('fechaCarga').value],
    ['Fecha entrega',     document.getElementById('fechaEntrega').value],
    ['Fecha reporte VTS', document.getElementById('fechaReporte').value],
    ['Registrado por',    document.getElementById('registradoPor').value],
    ['Productos',         products.map(p => `${p.marca} â€” ${p.sku} â€” ${p.motivo} (${p.piezas} pzas)`).join(' | ')],
    ['Fotos',             activePhotos().length > 0 ? `${activePhotos().length} foto(s)` : 'Sin fotos'],
  ];

  const box = document.getElementById('summaryBox');
  box.innerHTML = rows.map(([k, v]) => `
    <div class="summary-row">
      <span class="summary-key">${k}</span>
      <span class="summary-val">${v || 'â€”'}</span>
    </div>
  `).join('');
}

// â”€â”€ SUBMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function submitForm() {
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = '<span class="spinner"></span>Enviando...';

  const unidad       = document.getElementById('unidad').value;
  const almacen      = document.getElementById('almacen').value;
  const ov           = document.getElementById('ov').value.trim();
  const cliente      = document.getElementById('cliente').value.trim();
  const fechaCarga   = document.getElementById('fechaCarga').value;
  const fechaEntrega = document.getElementById('fechaEntrega').value;
  const fechaReporte = document.getElementById('fechaReporte').value;

  const registradoPor= document.getElementById('registradoPor').value.trim();
  const ts           = new Date().toLocaleString('es-MX');

  const d = new Date();
  const fecha = String(d.getDate()).padStart(2,'0') + String(d.getMonth()+1).padStart(2,'0') + d.getFullYear();
  const folderName = unidad + fecha; // Power Automate agrega el consecutivo

  const products = getProducts();
  const rows = products.map(p => ({
    unidad, almacen, ov, cliente,
    fechaCarga, fechaEntrega, fechaReporte,
    motivo: p.motivo, registradoPor, timestamp: ts,
    marca: p.marca, sku: p.sku, descripcion: p.desc, piezas: p.piezas
  }));

  // Encode photos
  let photosData = [];
  const activeP = activePhotos();
  if (activeP.length > 0) {
    document.getElementById('uploadProg').classList.add('show');
    for (let i = 0; i < activeP.length; i++) {
      document.getElementById('progText').textContent = `${i+1}/${activeP.length}`;
      document.getElementById('progFill').style.width = `${(i/activeP.length)*100}%`;
      const ext = activeP[i].name.split('.').pop() || 'jpg';
      const b64 = await fileToB64(activeP[i]);
      photosData.push({ name: `${folderName}_foto${i+1}.${ext}`, mimeType: activeP[i].type || 'image/jpeg', data: b64 });
    }
    document.getElementById('progFill').style.width = '100%';
  }

  const payload = { rows, photos: photosData.length > 0 ? photosData : [], folderName, unidad, fecha };

  try {
    const response = await fetch(POWER_AUTOMATE_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (response.ok || response.status === 202) {
      document.getElementById('mainForm').style.display = 'none';
      document.querySelector('.steps').style.display = 'none';
      document.getElementById('successFolio').textContent = `${unidad}${fecha}-#`;
      document.getElementById('successScreen').classList.add('show');
    } else {
      const errText = await response.text();
      console.error('Power Automate error:', response.status, errText);
      btn.disabled = false;
      btn.innerHTML = 'âœ” Registrar incidencia';
      alert('Error ' + response.status + ': ' + errText);
    }
  } catch(err) {
    console.error('Fetch error:', err);
    // no-cors workaround - assume success if network error after sending
    document.getElementById('mainForm').style.display = 'none';
    document.querySelector('.steps').style.display = 'none';
    document.getElementById('successFolio').textContent = `${unidad}${fecha}-#`;
    document.getElementById('successScreen').classList.add('show');
  }
}

// â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetAll() {
  document.getElementById('mainForm').reset();
  document.getElementById('mainForm').style.display = 'block';
  document.querySelector('.steps').style.display = 'flex';
  document.getElementById('successScreen').classList.remove('show');
  document.getElementById('uploadProg').classList.remove('show');
  document.getElementById('progFill').style.width = '0%';
  document.getElementById('productsList').innerHTML = '';
  document.getElementById('photoGrid').innerHTML = '';
  document.getElementById('photoInfo').textContent = '';
  photos = []; productCount = 0;
  addProduct();
  goTo(1);
  document.getElementById('fechaReporte').value = new Date().toISOString().split('T')[0];
  document.getElementById('submitBtn').disabled = false;
  document.getElementById('submitBtn').innerHTML = 'âœ” Registrar incidencia';
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('btnAdd').addEventListener('click', addProduct);
document.getElementById('fechaReporte').value = new Date().toISOString().split('T')[0];
addProduct();
</script>
</body>
</html>
